#version 330 core

in vec3 surfaceNormal;
in vec3 toLightVector;
in vec2 texCoords;
in float visibility;

layout(location = 0) out vec4 diffuseColor;

uniform sampler2D diffuseTex;

float ambientLighting = 0.3;
vec3 skyColor = vec3(0, 0.4f, 0.7f); //should be uniform

void main() {

	float nDotl = dot(normalize(surfaceNormal), normalize(toLightVector));
	float brightness = max(nDotl, ambientLighting);

	vec4 textureColor = texture2D(diffuseTex, texCoords);
	
	if(textureColor.a < 0.5){
		discard; //fake transparency for grass
	}

	diffuseColor = vec4(brightness, brightness, brightness, 1.0) * textureColor;

	diffuseColor = mix(vec4(skyColor, 1.0), diffuseColor, visibility);
}; 